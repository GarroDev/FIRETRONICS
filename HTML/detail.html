<!DOCTYPE html>
<html lang="en">

<head>
    <title>Welcome to FireTronics</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link href="../CSS/Details.css" rel="stylesheet">
</head>

<body>
  <header>
    <div class="Esplogo">
        <a href="Index.html"><img src="../imagenes/Logo.png" id="Logo" alt="FireTronics Logo"></a>
    </div>

    <div class="Container-halves">
        <div class="Login">
            <div class="searchengine">
                <h1 class="principal-header">FIRETRONICS</h1>
                <h6 class="principal-header1">your best ally in technology</h6>
            </div>
            <div class="buttons">
                <a href="http://localhost:5501/HTML/SingIn/src/SignIn.html">
                    <button class="custom-btn btn-1 Log-Btn1">Sign In</button>
                </a>
                <a href="../HTML/SignUp.html">
                    <button class="custom-btn btn-1 Log-Btn1">Sign Up</button>
                </a>
                <div id="login-header" class="Log-Btn2">
                    <img src="../imagenes/avatar.webp" alt="SignIn">                        
                    <button class="custom-btn btn-1" onclick="LogOutF()">Log Out</button>
                    <a href="../HTML/Admin.html">
                        <button class="custom-btn btn-1 ">Admin</button>
                        </a>

                        <h1 id="user-name"></h1>
                        <h1 id="username"> </h1>
                        
                        
                </div>
                <a href="../HTML/ShoppingCart.html">
                    <button id="cartBtn" class="custom-btn btn-2">
                        <i class="bi bi-cart4" style="height: 20px; width: 20px;"></i>
                        <span id="cartItemCount"></span>
                    </button>
                </a>
            </div>
        </div>
        <div class="Menu"></div>
        <ul class="nav">
            <li><a href="../HTML/Index.html" class="Spaces">Home</a></li>
            <li><a href="../HTML/products.html" class="Spaces">Products</a>
            <!-- <ul>
                    <br>
                    <li id="Title1SubMenu"><b>Phone & Smart Wash</b></li><br>
                    <li><a href="http://localhost/Products/?opcion_submenu=cellPhone#SectionDestino">Cell Phone</a></li>
                    <li><a href="http://localhost/Products/?opcion_submenu=AccesoriesPhone#SectionDestino">Smart Wash</a></li>
                    <br>
                    <li id="Title1SubMenu"><b>Computing</b></li><br>
                    <li><a href="http://localhost/Products/?opcion_submenu=DesktopComputer#SectionDestino">desktop computer</a></li>
                    <li><a href="../HTML/laptops.html">Laptops</a></li>
                    <br>
                    <li id="Title1SubMenu"><b>TV, Audio/Video</b></li><br>
                    <li><a href="">Smart TV</a></li>
                    <li><a href="">Sound equipment</a></li>
                </ul> -->
            </li>
            <li><a href="../HTML/WhoWeAre.html" class="Spaces">Who Are We</a></li>
        </ul>
    </div>
</header>
    <div id="Separator"></div>

    <!-- Web site body -->
    <main>
        <br>
        <div class="container">
            <div class="item">
              <div id="setIMGElement"></div>
              <div class="text-container">
                <div id="setnameElement"></div>
                <div id="setDescriptionElement"></div>
                <div id="setPriceElement"></div>
                <div id="setIDElement"></div>
                <div id="setStockElement"></div>
                <div id="productDetails"></div>
                <!-- Rating and Comments Section -->
                <h4>Rate this product</h4>
                <form id="ratingForm">
                    <div class="form-group">
                        <label for="rating">Rating:</label>
                        <select id="rating" class="form-select">
                            <option value="1">1 Star</option>
                            <option value="2">2 Stars</option>
                            <option value="3">3 Stars</option>
                            <option value="4">4 Stars</option>
                            <option value="5">5 Stars</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="comment">Comment:</label>
                        <textarea id="comment" class="form-control" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary mt-3">Submit</button>
                </form>

                <h4 class="mt-5">Comments</h4>
                <div id="commentsSection"></div>
              </div>
            </div>
          </div>
        <br>

        <div class="container-fluid">
            <!-- Help button -->
            <button id="helpButton" class="circular-button btn btn-primary">?</button>
            <!-- Help popup -->
            <div id="helpPopup" class="popup">
                <div class="popup-content">
                    <span class="close">×</span>
                    <div class="chat">
                        <div id="chatArea" class="chat-area">
                            <p class="Sys">How can I help?<br></p>
                        </div>
                        <div id="helpList" class="list-group"><br>
                            <button class="help-button list-group-item list-group-item-action chatsub" value="Problem">I have an issue</button>
                            <button class="help-button list-group-item list-group-item-action chatsub" value="Consult">I have a question</button>
                            <button class="help-button list-group-item list-group-item-action chatsub" value="Suggestion">I wanna do a suggestion</button>
                            <br>
                        </div>
                    </div>
                </div>
            </div>
            <button id="myWhatsAppButton" class="circular-button2 btn btn-primary"><i class="bi bi-whatsapp"></i></button>
            <button id="theme-toggle" class="circular-button3 btn btn-primary"><i class="bi bi-lightbulb"></i></button>
        </div>

        
    </main>

    <!-- Web site footer -->
    <footer>
        <p id="titleFooter1">FireTronics</p>
        <p id="titleFooter2">All Rights Reserved</p>
        <p id="titleFooter3">Politécnico Colombiano Jaime Isaza Cadavid</p>
        <p id="titleFooter4">2024</p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="../JavaScript/script.js"></script>
    <script src="../JavaScript/details.js"></script>

    <script>
   document.addEventListener('DOMContentLoaded', async () => {
  const urlParams = new URLSearchParams(window.location.search);
  const productId = urlParams.get('id');

  if (!productId || isNaN(productId)) {
    console.error('Invalid product ID');
    return;
  }

  // Fetch product details
  try {
    const response = await fetch(`http://localhost:3002/getProductDetails`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ id: productId })
    });

    if (!response.ok) {
      throw new Error('Failed to fetch product details');
    }

    const responseText = await response.text();
    let product;

    try {
      product = JSON.parse(responseText);
    } catch (error) {
      console.error('Error parsing JSON:', responseText);
      throw error;
    }

    document.getElementById('setIMGElement').innerHTML = `<img src="${product.IMG}" alt="${product.Name}" class="img-fluid">`;
    document.getElementById('setnameElement').textContent = product.Name;
    document.getElementById('setPriceElement').textContent = `Price: ${product.Price}`;
    document.getElementById('setStockElement').textContent = `Stock: ${product.Stock}`;
    document.getElementById('setDescriptionElement').textContent = product.Description;
  } catch (error) {
    console.error('Error fetching product details:', error.message);
  }

  // Fetch comments
  try {
    const response = await fetch(`http://localhost:3002/getComments`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ productId: productId })
    });

    if (!response.ok) {
      throw new Error('Failed to fetch comments');
    }

    const responseText = await response.text();
    let comments;

    try {
      comments = JSON.parse(responseText);
    } catch (error) {
      console.error('Error parsing JSON:', responseText);
      throw error;
    }

    const commentsSection = document.getElementById('commentsSection');
    commentsSection.innerHTML = '';
    comments.forEach(comment => {
      const commentDiv = document.createElement('div');
      commentDiv.classList.add('comment');
      commentDiv.innerHTML = `
        <strong>${comment.rating} Stars</strong>
        <p>${comment.text}</p>
      `;
      commentsSection.appendChild(commentDiv);
    });
  } catch (error) {
    console.error('Error fetching comments:', error.message);
  }

  // Submit rating form
  document.getElementById('ratingForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const rating = document.getElementById('rating').value;
    const comment = document.getElementById('comment').value;

    try {
      const response = await fetch(`http://localhost:3002/addComment`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          productId: productId,
          rating: rating,
          text: comment
        })
      });

      if (!response.ok) {
        throw new Error('Failed to submit comment');
      }

      alert('Comment submitted successfully');
      window.location.reload();
    } catch (error) {
      console.error('Error submitting comment:', error.message);
    }
  });
});

    </script>
</body>

</html>
