<!DOCTYPE html>
<html lang="en">
<head>
    <title>Product Administration</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <h1>Product Administration</h1>
        <form id="addProductForm">
            <div class="mb-3">
                <label for="ID_Product" class="form-label">ID Product</label>
                <input type="text" class="form-control" id="ID_Product" required>
            </div>
            <div class="mb-3">
                <label for="productName" class="form-label">Product Name</label>
                <input type="text" class="form-control" id="productName" required>
            </div>
            <div class="mb-3">
                <label for="productPrice" class="form-label">Price</label>
                <input type="number" class="form-control" id="productPrice" required>
            </div>
            <div class="mb-3">
                <label for="productStock" class="form-label">Stock</label>
                <input type="number" class="form-control" id="productStock" required>
            </div>
            <div class="mb-3">
                <label for="productDescription" class="form-label">Description</label>
                <textarea class="form-control" id="productDescription" rows="3" required></textarea>
            </div>
            <div class="mb-3">
                <label for="productImg" class="form-label">Image URL</label>
                <input type="url" class="form-control" id="productImg" required>
            </div>
            <div class="mb-3">
                <label for="productCategory" class="form-label">Category</label>
                <input type="text" class="form-control" id="productCategory" required>
            </div>
            <button type="submit" class="btn btn-primary">Add Product</button>
        </form>

        <h2 class="mt-5">Products List</h2>
        <div id="productList" class="mt-3"></div>

        <h2 class="mt-5">Users List</h2>
        <div id="UserList" class="mt-3"></div>
    </div>

    <script>
        document.getElementById('addProductForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const product = {
                ID_Product: document.getElementById('ID_Product').value,
                name: document.getElementById('productName').value,
                price: document.getElementById('productPrice').value,
                stock: document.getElementById('productStock').value,
                description: document.getElementById('productDescription').value,
                img: document.getElementById('productImg').value,
                category: document.getElementById('productCategory').value
            };

            try {
                const response = await fetch('http://localhost:3002/addProduct', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(product)
                });

                if (!response.ok) {
                    throw new Error('Failed to add product');
                }

                alert('Product added successfully!');
                fetchProducts();
            } catch (error) {
                alert('Error adding product: ' + error.message);
            }
        });

        async function fetchProducts() {
            try {
                const response = await fetch('http://localhost:3002/getAllProducts');
                const products = await response.json();
                const productList = document.getElementById('productList');
                productList.innerHTML = '';
                products.forEach(product => {
                    const productDiv = document.createElement('div');
                    productDiv.classList.add('card', 'mb-3');
                    productDiv.style.width = '18rem';
                    productDiv.innerHTML = `
                        <img src="${product.IMG}" class="card-img-top" alt="Product Image">
                        <div class="card-body">
                            <h5 class="card-title">${product.Name}</h5>
                            <p class="card-text">Price: $${product.Price}</p>
                            <p class="card-text">Stock: ${product.Stock}</p>
                            <p class="card-text">Description: ${product.Description}</p>
                            <p class="card-text">Category: ${product.Category}</p>
                            <button class="btn btn-danger" onclick="deleteProduct(${product.ID_Product})">Delete</button>
                            <button class="btn btn-primary" onclick="editProduct(${product.ID_Product})">Edit</button>
                        </div>
                    `;
                    productList.appendChild(productDiv);
                });
            } catch (error) {
                alert('Error fetching products: ' + error.message);
            }
        }

        async function deleteProduct(id) {
            try {
                const response = await fetch('http://localhost:3002/deleteProduct', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ id })
                });

                if (!response.ok) {
                    throw new Error('Failed to delete product');
                }

                alert('Product deleted successfully!');
                fetchProducts();
            } catch (error) {
                alert('Error deleting product: ' + error.message);
            }
        }

        async function updateProduct(product) {
            try {
                const response = await fetch('http://localhost:3002/updateProduct', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(product)
                });

                if (!response.ok) {
                    throw new Error('Failed to update product');
                }

                alert('Product updated successfully!');
            } catch (error) {
                alert('Error updating product: ' + error.message);
            }
        }

        async function fetchUsers() {
            try {
                const response = await fetch('http://localhost:3002/getAllUsers');
                const products = await response.json();
                const UserList = document.getElementById('UserList');
                UserList.innerHTML = '';
                products.forEach(product => {
                    const productDiv = document.createElement('div');
                    productDiv.classList.add('card', 'mb-3');
                    productDiv.style.width = '18rem';
                    productDiv.innerHTML = `
                        <div class="card-body">
                            <h5 class="card-title">${name}</h5>
                            <p class="card-text">Email: $${product.email}</p>
                            <button class="btn btn-danger" onclick="deleteProduct(${product.ID_Product})">Delete</button>
                            <button class="btn btn-primary" onclick="editProduct(${product.ID_Product})">Edit</button>
                        </div>
                    `;
                    UserList.appendChild(productDiv);
                });
            } catch (error) {
                alert('Error fetching products: ' + error.message);
            }
        }

        window.onload = fetchProducts;
    </script>
</body>
</html>
